<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4660461160504958" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sfawy Motion | ØµÙØ§ÙˆÙŠ Ù…ÙˆØ´Ù†</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyCpLDn2CMWObwSHCjWqh6s6TWLyPraXicI",
        authDomain: "sfawy-e4f39.firebaseapp.com",
        projectId: "sfawy-e4f39",
        storageBucket: "sfawy-e4f39.firebasestorage.app",
        messagingSenderId: "395891884699",
        appId: "1:395891884699:web:bb324267db21bdfba8fc3e"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
    </script>

    <style>
        :root { --primary: #00f2ea; --secondary: #ff0050; --dark: #050505; --glass: rgba(255, 255, 255, 0.05); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--dark); color: white; display: flex; flex-direction: column; min-height: 100vh; overflow-x: hidden; }

        nav { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.9); border-bottom: 1px solid #222; position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.4rem; font-weight: 900; color: white; text-decoration: none; }
        .logo span { color: var(--primary); }
        .btn-nav { background: var(--primary); color: black; padding: 8px 15px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; }

        .main-content { flex: 1; padding: 20px; max-width: 600px; margin: 0 auto; width: 100%; }
        .post-card { background: var(--glass); border-radius: 20px; border: 1px solid #222; margin-bottom: 25px; padding: 20px; position: relative; }
        .user-info { display: flex; align-items: center; margin-bottom: 10px; }
        .user-info img { width: 30px; height: 30px; border-radius: 50%; margin-left: 10px; border: 1px solid var(--primary); }
        video { width: 100%; border-radius: 12px; background: #000; margin-top: 10px; }
        
        .btn-unlock { background: linear-gradient(45deg, var(--secondary), #ff4d8d); color: white; width: 100%; padding: 12px; border-radius: 10px; border: none; cursor: pointer; margin-top: 15px; font-weight: bold; }
        .hidden-img { width: 100%; border-radius: 12px; margin-top: 15px; display: none; border: 2px solid var(--primary); }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-box { background: #1a1a1a; padding: 25px; border-radius: 20px; width: 90%; max-width: 450px; border: 1px solid #333; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #333; border-radius: 8px; background: #000; color: white; text-align: right; }

        #ad-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .ad-timer-text { font-size: 4rem; color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

    <div id="ad-overlay">
        <p id="ad-status" style="margin-bottom: 20px;">Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­ØµØ±ÙŠ...</p>
        <div class="ad-timer-text" id="ad-timer">5</div>
        <div style="margin-top: 20px; width: 300px; height: 250px; background: #222;">
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4660461160504958" data-ad-slot="1234567890" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
    </div>

    <nav>
        <a href="#" class="logo">ØµÙØ§ÙˆÙŠ <span>Ù…ÙˆØ´Ù†</span></a>
        <div id="auth-zone">
            <button class="btn-nav" id="btnRegister" onclick="openModal('loginModal')">Ø³Ø¬Ù„ Ø¨ØªÙŠÙƒ ØªÙˆÙƒ</button>
            <button class="btn-nav" id="btnPublish" style="display:none; background:white;" onclick="openModal('publishModal')">+ Ø§Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
        </div>
    </nav>

    <div class="main-content" id="feed">
        <p style="text-align: center; color: #888;">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª...</p>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-box">
            <h3 style="margin-bottom:15px;">Ø±Ø¨Ø· Ø­Ø³Ø§Ø¨ ØªÙŠÙƒ ØªÙˆÙƒ ğŸ“±</h3>
            <input type="text" id="uName" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±">
            <input type="text" id="uHandle" placeholder="ÙŠÙˆØ²Ø± ØªÙŠÙƒ ØªÙˆÙƒ (Ø¨Ø¯ÙˆÙ† @)">
            <button class="btn-nav" style="width:100%; margin-top:10px;" onclick="saveProfile()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
            <p onclick="closeModals()" style="color:red; cursor:pointer; margin-top:15px; text-align:center;">Ø¥Ù„ØºØ§Ø¡</p>
        </div>
    </div>

    <div id="publishModal" class="modal">
        <div class="modal-box">
            <h3>Ø§Ù†Ø´Ø± Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯ ğŸš€</h3>
            <textarea id="pDesc" placeholder="ÙˆØµÙ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ..."></textarea>
            <input type="text" id="pVidUrl" placeholder="Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ ØªÙŠÙƒ ØªÙˆÙƒ">
            <input type="text" id="pImgUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­ØµØ±ÙŠØ©">
            <button class="btn-nav" style="width:100%" onclick="submitPost()">Ù†Ø´Ø± Ø¹Ø§Ù„Ù…ÙŠ</button>
            <p onclick="closeModals()" style="color:red; cursor:pointer; margin-top:15px; text-align:center;">Ø¥Ù„ØºØ§Ø¡</p>
        </div>
    </div>

    <script>
        // 1. ØªØ°ÙƒØ± Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„
        window.onload = function() {
            showAd("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØµÙØ§ÙˆÙŠ Ù…ÙˆØ´Ù†...", 5); // Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„
            const savedUser = localStorage.getItem('safawy_user');
            if (savedUser) {
                document.getElementById('btnRegister').style.display = 'none';
                document.getElementById('btnPublish').style.display = 'block';
            }
        };

        // 2. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ±
        function showAd(msg, seconds, callback) {
            const overlay = document.getElementById('ad-overlay');
            const timer = document.getElementById('ad-timer');
            const status = document.getElementById('ad-status');
            
            status.innerText = msg;
            overlay.style.display = 'flex';
            let count = seconds;
            timer.innerText = count;

            let interval = setInterval(() => {
                count--;
                timer.innerText = count;
                if(count <= 0) {
                    clearInterval(interval);
                    overlay.style.display = 'none';
                    if(callback) callback();
                }
            }, 1000);
        }

        // Ø¥Ø¹Ù„Ø§Ù† ØµÙˆØ±ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
        setInterval(() => {
            if(document.getElementById('ad-overlay').style.display !== 'flex') {
                showAd("Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø³Ø±Ø¹Ø©...", 3);
            }
        }, 60000);

        // 3. Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø­ÙØ¸ (ÙÙƒØ±Ø© ØªÙŠÙƒ ØªÙˆÙƒ)
        function saveProfile() {
            const name = document.getElementById('uName').value;
            const handle = document.getElementById('uHandle').value.replace('@', '');
            if(!name || !handle) return alert("Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙŠØ§ Ø¨Ø·Ù„!");

            const userData = { name: name, handle: handle };
            localStorage.setItem('safawy_user', JSON.stringify(userData));
            location.reload();
        }

        // 4. Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
        db.collection('all_posts').orderBy('time', 'desc').onSnapshot(snapshot => {
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            snapshot.forEach(doc => {
                const data = doc.data();
                const post = document.createElement('div');
                post.className = 'post-card';
                post.innerHTML = `
                    <div class="user-info">
                        <img src="https://ui-avatars.com/api/?name=${data.userHandle}&background=00f2ea&color=000" alt="avatar">
                        <small>@${data.userHandle} â€¢ ${data.userName}</small>
                    </div>
                    <p>${data.desc}</p>
                    <video controls poster="${data.imgUrl}" src="${data.vidUrl}"></video>
                    <button class="btn-unlock" onclick="unlockContent(this, '${data.imgUrl}')">ÙØªØ­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­ØµØ±ÙŠ (Ø¥Ø¹Ù„Ø§Ù† 5Ø«)</button>
                    <img class="hidden-img" src="${data.imgUrl}">
                `;
                feed.appendChild(post);
            });
        });

        function unlockContent(btn, img) {
            showAd("Ø¬Ø§Ø±ÙŠ ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ± Ø¹Ù† Ø§Ù„ØµÙˆØ±Ø©...", 5, () => {
                btn.style.display = 'none';
                btn.nextElementSibling.style.display = 'block';
            });
        }

        // 5. Ø§Ù„Ù†Ø´Ø± (Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø®ÙÙŠÙØ©)
        async function submitPost() {
            const desc = document.getElementById('pDesc').value;
            const vid = document.getElementById('pVidUrl').value;
            const img = document.getElementById('pImgUrl').value;
            const user = JSON.parse(localStorage.getItem('safawy_user'));

            if(!desc || !vid) return alert("Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„Ø±Ø§Ø¨Ø· Ù…Ø·Ù„ÙˆØ¨Ø§Ù†!");

            await db.collection('all_posts').add({
                desc: desc, vidUrl: vid, imgUrl: img,
                userName: user.name, userHandle: user.handle,
                time: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!");
            closeModals();
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }
    </script>
</body>
</html>
